<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./اساسيات/icon.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="./style.css">
    <title>The Rahmany Management</title>
</head>

<body>
<!--###############################################################################################-->
<!--###############################################################################################-->
<!--sidebar-->
<div class="sidebar">
    <h2 class="logo">October High Institute</h2>
    <div class="sidebar-menus">
        <a href="https://www.facebook.com/ohinstitute">الصفحة الرسمية</a>
        <a href="https://www.ohi.edu.eg/default.aspx">الموقع الرسمي</a>
        <a href="https://wa.me/+201102716716?text=مرحبا اريد التواصل معكم">الدعم الفني</a>
        <a href="./auth.html">فورم التسجيل</a>
        <a href="./about.html">من نحن</a>
        <a href="./AI.html">المساعد الذكي</a>
        <a href="#" class="menu-off">إغلاق</a>
    </div>
</div>
<!--###############################################################################################-->
<!--###############################################################################################-->
<!--navbar-->
<div class="navbar">
    <div class="menu-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32" fill="currentColor" style="color: aliceblue;">
            <path d="M5 5H13V19H5V5ZM19 19H15V5H19V19ZM4 3C3.44772 3 3 3.44772 3 4V20C3 20.5523 3.44772 21 4 21H20C20.5523 21 21 20.5523 21 20V4C21 3.44772 20.5523 3 20 3H4ZM7 12L11 8.5V15.5L7 12Z"></path>
        </svg>
    </div>
    
    <img class="head-img" src="./اساسيات/logo-white.png" alt="شعار المعهد">
    
    <a href="./Location.html" class="user">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32" fill="currentColor" style="color: aliceblue;"  >
            <path d="M12 20.8995L16.9497 15.9497C19.6834 13.2161 19.6834 8.78392 16.9497 6.05025C14.2161 3.31658 9.78392 3.31658 7.05025 6.05025C4.31658 8.78392 4.31658 13.2161 7.05025 15.9497L12 20.8995ZM12 23.7279L5.63604 17.364C2.12132 13.8492 2.12132 8.15076 5.63604 4.63604C9.15076 1.12132 14.8492 1.12132 18.364 4.63604C21.8787 8.15076 21.8787 13.8492 18.364 17.364L12 23.7279ZM12 13C13.1046 13 14 12.1046 14 11C14 9.89543 13.1046 9 12 9C10.8954 9 10 9.89543 10 11C10 12.1046 10.8954 13 12 13ZM12 15C9.79086 15 8 13.2091 8 11C8 8.79086 9.79086 7 12 7C14.2091 7 16 8.79086 16 11C16 13.2091 14.2091 15 12 15Z"></path>
        </svg>
    </a>
</div>


    <div class="registration-form">
        <form id="registration-form" name="registration-form">
            <div class="form-group">
                <label for="رقم عامل التوصيل">رقم العامل بالترتيب:</label>
                <input type="number" id="رقم عامل التوصيل" name="name" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label for="الكود">الكود :</label>
                <input type="number" id="الكود" name="الكود" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label for="الاسم">الاسم ثنائي:</label>
                <input type="text" id="الاسم" name="الاسم" class="form-control" min="16" max="30" required pattern="[\u0600-\u06FF\s]+" title="يُسمح فقط بالحروف العربية" >
            </div>
            
            <div class="form-group">
                <label for="حضور"> وقت الحضور:</label>
                <input type="number" id="حضور" name="حضور" class="form-control" pattern="[0-9]{11}" title="يجب أن يتكون رقم الهاتف من 11 رقمًا" required>
            </div>
    
            <div class="form-group">
                <label for="انصراف"> وقت النصراف:</label>
                <input type="number" id="انصراف" name="انصراف" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label for="عدد ساعات العمل">عدد ساعات العمل :</label>
                <input type="number" id="عدد ساعات العمل" name="عدد ساعات العمل" class="form-control" pattern="[0-9]{11}" title="يجب أن يتكون رقم الهاتف من 11 رقمًا" required>
            </div>
    

            <div class="form-group">
                <label for="إجمالي التوصيل">اجمالي التوصيل :</label>
                <input type="number" id="إجمالي التوصيل" name="إجمالي التوصيل" class="form-control" pattern="[0-9]{11}" title="يجب أن يتكون رقم الهاتف من 11 رقمًا" required>
            </div>
    
            <div class="form-group">
                <label for="  الخصم"> الخصم:</label>
                <input type="number" id="  الخصم" name="  الخصم" class="form-control" pattern="[0-9]{11}" title="يجب أن يتكون رقم الهاتف من 11 رقمًا" required>
            </div>

            <div class="form-group">
                <label for=" الإضافة "> الاضافه:</label>
                <input type="number" id=" الإضافة " name=" الإضافة " class="form-control" pattern="[0-9]{11}" title="يجب أن يتكون رقم الهاتف من 11 رقمًا" required>
            </div>

            <div class="form-group">
                <label for="الصافي"> الصافي:</label>
                <input type="number" id="الصافي" name="الصافي" class="form-control" pattern="[0-9]{11}" title="يجب أن يتكون رقم الهاتف من 11 رقمًا" required>
            </div>


            <div class="form-group">
                <label for="عدد الخدمات فوق"> عدد الخدمات فوق:</label>
                <input type="number" id="عدد الخدمات فوق" name="عدد الخدمات فوق" class="form-control" pattern="[0-9]{11}" title="يجب أن يتكون رقم الهاتف من 11 رقمًا" required>
            </div>

            
            <button type="submit" class="submit-btn" id="submitBtn">تسجيل</button>
            
            <!-- رسالة جاري الإرسال -->

            <div id="loadingMessage" style="display: none; text-align: center; margin-top: 15px;">
                <p style="margin-top: 10px;">جاري إرسال البيانات، الرجاء الانتظار...</p>
            </div> 
        </form>
    </div>

    <br> <br> <hr> <br> <br>
    <div class="main-nav-buttons">
        <a href="./End_expense_shift.html" class="nav-btn">
            <i class="fas fa-utensils"></i>
            <span>  انهاء الدورية ( الشيف )  </span>
        </a>
    </div>
    <br> <br> <br> <br>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbyjFJJXmKxI3fVP4jI_8aTCptL1UEX5xdvB_CyLJdy8li9OGd3x7w2FRdiAbS_MXAI/exec";
        const form = document.forms["registration-form"];
        const submitBtn = document.getElementById("submitBtn");
        const loadingMessage = document.getElementById("loadingMessage");
        
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            
            // جلب قيمة الshiftNumber من اللوكل ستوريج
            const shiftNumber = localStorage.getItem('shiftNumber');
            
            // التحقق من وجود القيمة
            if(!shiftNumber) {
                Swal.fire('خطأ', ' لم يتم العثور على رقم الشيفت في النظام سجل خروج وادخل تاني', 'error');
                return;
            }
            
            if(!form.checkValidity()) {
                Swal.fire('خطأ', 'يرجى ملء جميع الحقول المطلوبة بشكل صحيح', 'error');
                return;
            }
            
            submitBtn.disabled = true;
            loadingMessage.style.display = "block";
            
            // إنشاء كائن FormData وإضافة shiftNumber
            const formData = new FormData(form);
            formData.append('shiftNumber', shiftNumber); // إضافة القيمة هنا
            
            fetch(scriptURL, { 
                method: "POST", 
                body: formData // استخدام الكائن المعدل
            })
            .then((response) => {
                if(response.ok) {
                    Swal.fire('تم بنجاح', 'تم تسجيل البيانات بنجاح', 'success');
                    form.reset();
                } else {
                    throw new Error('Network response was not ok');
                }
            })
            .catch((error) => {
                Swal.fire('خطأ', 'حدث خطأ أثناء محاولة التسجيل', 'error');
                console.error('Error:', error);
            })
            .finally(() => {
                submitBtn.disabled = false;
                loadingMessage.style.display = "none";
            });
        });
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const shiftNumber = localStorage.getItem('shiftNumber');
            if (!shiftNumber) {
                window.location.href = './index.html';
            } else {
                document.getElementById('shiftNumber').textContent = shiftNumber;
            }
        });
    </script>
</body>

</html>